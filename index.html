<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Acceso a la c치mara</title>
</head>
<body>
    <video id="videoElement" autoplay playsinline></video>
    <input type="range" min="0" max="100" value="0" step="1" onchange="applyMakeup(this.value)">
    <button onclick="startCamera()">Encender c치mara</button>
    <button onclick="stopCamera()">Apagar c치mara</button>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tracking.js/1.1.3/tracking-min.js"></script>
    <script>
        let stream; 
        let videoStream;
        let canvas = document.createElement('canvas');
        let ctx = canvas.getContext('2d');
        let tracker;

        const selectCamera = async () => {
            try {
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(device => device.kind === 'videoinput');

                const selectedDevice = videoDevices[0]; 

                stream = await navigator.mediaDevices.getUserMedia({ video: { deviceId: { exact: selectedDevice.deviceId } } });
                const videoElement = document.getElementById('videoElement');
                videoElement.srcObject = stream;

                videoStream = stream.clone(); 

                tracker = new window.tracking.ObjectTracker('face');
                tracker.setInitialScale(4);
                tracker.setStepSize(2);
                tracker.setEdgesDensity(0.1);
                window.tracking.track(videoElement, tracker, { camera: true });

                tracker.on('track', function(event) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    event.data.forEach(function(rect) {
                        ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
                        ctx.fillStyle = 'rgba(255, 0, 0, 0.5)';
                        ctx.fillRect(rect.x, rect.y, rect.width, rect.height);
                    });
                });
            } catch (error) {
                console.error('Error al acceder a la c치mara:', error);
            }
        };


        const startCamera = async () => {
            if (!stream) {
                await selectCamera();
            }
        };


        const stopCamera = () => {
            if (stream) {
                const tracks = stream.getTracks();
                tracks.forEach(track => track.stop());
                stream = null;
            }
        };

const applyMakeup = (value) => {
    ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);

    event.data.forEach(function(rect) {
        const { x, y, width, height } = rect;

        const imageData = ctx.getImageData(x, y, width, height);
        const data = imageData.data;

        const skinToneChange = value * 2.55; 
        for (let i = 0; i < data.length; i += 4) {
            data[i] += skinToneChange; 
            data[i + 1] += skinToneChange; 


            data[i] = Math.min(255, Math.max(0, data[i]));
            data[i + 1] = Math.min(255, Math.max(0, data[i + 1]));
        }


        ctx.putImageData(imageData, x, y);
    });

    videoElement.srcObject = canvas.captureStream().getVideoTracks()[0];
};

    </script>
</body>
</html>
